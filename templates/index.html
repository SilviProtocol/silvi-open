<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Treekipedia GraphFlow</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
    <link rel="stylesheet" href="/static/css/treekipedia-unified.css">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-dna"></i> Treekipedia GraphFlow</h1>
        <p class="lead">
          Smart Ontology Generator - Data flowing from sheets → RDF → Blazegraph
        </p>
        <!-- Documentation Button in Header -->
        <div class="mt-3">
          <a href="/documentation" target="_blank" class="btn btn-outline-light btn-sm me-2">
            <i class="fas fa-book me-1"></i>Documentation
          </a>
          <button class="btn btn-outline-light btn-sm" onclick="showQuickHelp()">
            <i class="fas fa-question-circle me-1"></i>Quick Help
          </button>
        </div>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %} 
      {% if messages %} 
      {% for category, message in messages %}
      <div class="alert alert-{{ category if category != 'error' else 'danger' }} alert-dismissible fade show">
        <i class="fas fa-{{ 'exclamation-circle' if category == 'error' else 'info-circle' }}"></i>
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %} 
      {% endif %} 
      {% endwith %}

      <!-- System Status -->
      <div class="system-status">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4><i class="fas fa-heartbeat"></i> System Status</h4>
          <div class="d-flex gap-2">
            {% if has_dynamic_ontology %}
            <span class="status-indicator connected">
              <i class="fas fa-magic me-1"></i> Smart Ontology Ready
            </span>
            {% endif %}
            <button class="btn btn-outline-primary btn-sm" onclick="refreshSystemStatus()">
              <i class="fas fa-sync-alt me-1"></i>Refresh
            </button>
          </div>
        </div>
        <div class="status-grid">
          <div class="status-item">
            <h6>Blazegraph</h6>
            <div id="blazegraph-status" class="status-indicator disconnected">
              <i class="fas fa-spinner fa-spin me-1"></i> Checking...
            </div>
          </div>
          <div class="status-item">
            <h6>Google Sheets</h6>
            <div id="sheets-status" class="status-indicator disconnected">
              <i class="fas fa-spinner fa-spin me-1"></i> Checking...
            </div>
          </div>
          <div class="status-item">
            <h6>PostgreSQL</h6>
            <div id="postgres-status" class="status-indicator disconnected">
              <i class="fas fa-spinner fa-spin me-1"></i> Checking...
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-8">
          <!-- File Upload Section -->
          <div class="file-upload">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3><i class="fas fa-upload"></i> Create Ontology from Files</h3>
              <button class="btn btn-outline-secondary btn-sm" onclick="showContextualHelp('csv-upload')">
                <i class="fas fa-question-circle"></i> Help
              </button>
            </div>
            
            <form action="{{ url_for('main.upload_files') }}" method="post" enctype="multipart/form-data" id="uploadForm">
              <div class="mb-4">
                <label for="ontology_name" class="form-label">Ontology Name</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-tag"></i></span>
                  <input type="text" class="form-control" id="ontology_name" name="ontology_name" value="biodiversity-ontology" placeholder="Enter ontology name" />
                </div>
                <div class="form-text">
                  The name of your ontology file (without .owl extension)
                </div>
              </div>

              <div class="mb-4">
                <label class="form-label"><i class="fas fa-table"></i> Upload CSV Files</label>
                <div class="file-input-wrapper">
                  <div class="file-input-button">
                    <i class="fas fa-file-csv"></i> Choose Files
                  </div>
                  <span class="file-input-text">No files selected</span>
                  <input type="file" class="form-control" id="files" name="files" accept=".csv" multiple />
                </div>
                <div class="selected-files" id="selectedFiles"></div>
                <div class="form-text">
                  Upload one or more CSV files for smart ontology generation
                </div>
              </div>

              <!-- Hidden input to always use dynamic ontology -->
              {% if has_dynamic_ontology %}
              <input type="hidden" name="use_dynamic_ontology" value="true">
              {% endif %}

              <div class="mt-4">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-cogs"></i> Generate Smart Ontology
                </button>
              </div>
            </form>
          </div>

          <!-- Integration Options -->
          <div class="integration-options">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3><i class="fas fa-plug"></i> Data Source Integrations</h3>
              <button class="btn btn-outline-secondary btn-sm" onclick="showContextualHelp('automation')">
                <i class="fas fa-question-circle"></i> Help
              </button>
            </div>
            <p class="text-muted mb-4">Choose your preferred data source for ontology generation</p>
            
            <div class="row">
              <div class="col-md-4 mb-3">
                <div class="integration-card">
                  <div class="feature-icon">
                    <i class="fas fa-table"></i>
                  </div>
                  <h5>Google Sheets</h5>
                  <p>Import directly from Google Sheets with automatic change detection, smart ontology generation, and version management.</p>
                  <div class="d-grid gap-2">
                    <a href="{{ url_for('main.import_from_sheets') }}" class="btn btn-outline-primary">
                      <i class="fas fa-table"></i> Import from Sheets
                    </a>
                    <button class="btn btn-outline-secondary btn-sm" onclick="showContextualHelp('google-sheets')">
                      <i class="fas fa-question-circle"></i> Setup Help
                    </button>
                  </div>
                  <div id="sheets-integration-status" class="status-indicator disabled">
                    <i class="fas fa-circle me-1"></i> Checking...
                  </div>
                </div>
              </div>
              
              <div class="col-md-4 mb-3">
                <div class="integration-card">
                  <div class="feature-icon">
                    <i class="fas fa-database"></i>
                  </div>
                  <h5>PostgreSQL</h5>
                  <p>Monitor PostgreSQL database for changes and automatically generate RDF from relational data.</p>
                  <div class="d-grid gap-2">
                    <a href="{{ url_for('api.postgres_monitor') }}" class="btn btn-outline-primary" id="postgres-monitor-btn">
                      <i class="fas fa-database"></i> PostgreSQL Monitor
                    </a>
                    <button class="btn btn-outline-secondary btn-sm" onclick="showContextualHelp('postgresql')">
                      <i class="fas fa-question-circle"></i> Setup Help
                    </button>
                  </div>
                  <div id="postgres-integration-status" class="status-indicator disabled">
                    <i class="fas fa-circle me-1"></i> Checking...
                  </div>
                </div>
              </div>
              
              <div class="col-md-4 mb-3">
                <div class="integration-card">
                  <div class="feature-icon">
                    <i class="fas fa-code-branch"></i>
                  </div>
                  <h5>Version Management</h5>
                  <p>Track changes and manage versions of your biodiversity data spreadsheets and ontologies.</p>
                  <div class="d-grid gap-2">
                    <a href="{{ url_for('api.version_management') }}" class="btn btn-outline-primary">
                      <i class="fas fa-code-branch"></i> Manage Versions
                    </a>
                    <button class="btn btn-outline-secondary btn-sm" onclick="showContextualHelp('version-management')">
                      <i class="fas fa-question-circle"></i> How To Use
                    </button>
                  </div>
                  <div class="status-indicator connected">
                    <i class="fas fa-check-circle me-1"></i> Available
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="info-card">
            <h4><i class="fas fa-info-circle"></i> About This Tool</h4>
            <p>
              This comprehensive tool generates OWL ontologies from various data sources,
              providing a complete solution for biodiversity knowledge representation.
            </p>
            <ul>
              <li><strong>Multi-source support:</strong> CSV files, Google Sheets, PostgreSQL</li>
              <li><strong>Smart analysis:</strong> Automatic field detection and categorization</li>
              <li><strong>Automatic validation:</strong> RDF structure checking</li>
              <li><strong>Blazegraph integration:</strong> Direct import to triple store</li>
              <li><strong>Version management:</strong> Track changes over time</li>
              <li><strong>Change detection:</strong> Only process updated data</li>
            </ul>
            <div class="mt-3">
              <a href="/documentation" target="_blank" class="btn btn-outline-primary btn-sm">
                <i class="fas fa-external-link-alt me-1"></i>Full Documentation
              </a>
            </div>
          </div>

          <div class="info-card">
            <h4><i class="fas fa-rocket"></i> Quick Actions</h4>
            <div class="d-grid gap-2">
              <button class="btn btn-outline-success" onclick="runFullAutomation()">
                <i class="fas fa-play"></i> Run Full Automation
              </button>
              <button class="btn btn-outline-info" onclick="checkSystemHealth()">
                <i class="fas fa-heartbeat"></i> System Health Check
              </button>
              <button class="btn btn-outline-warning" onclick="viewLogs()">
                <i class="fas fa-file-alt"></i> View System Logs
              </button>
            </div>
          </div>

          <div class="info-card">
            <h4><i class="fas fa-chart-line"></i> Recent Activity</h4>
            <div id="recent-activity">
              <p class="text-muted">Loading recent activity...</p>
            </div>
          </div>

          <div class="info-card">
            <h4><i class="fas fa-cogs"></i> Smart Configuration</h4>
            <p>
              The system automatically generates ontology structure from your data, detecting field types, categories, and relationships without manual configuration.
            </p>
            <div class="d-grid gap-2">
              <button class="btn btn-outline-secondary btn-sm" onclick="downloadSampleConfig()">
                <i class="fas fa-download"></i> Download Sample Data
              </button>
              <button class="btn btn-outline-secondary btn-sm" onclick="validateConfig()">
                <i class="fas fa-check"></i> Validate Data Structure
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <p>Biodiversity Ontology Generator | 
          <a href="/documentation" target="_blank">Documentation</a> | 
          <a href="#" onclick="showSupport()">Support</a>
        </p>
      </div>
    </div>

    <!-- All your existing modals remain the same -->
    <!-- System Status Modal -->
    <div class="modal fade" id="systemStatusModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="fas fa-heartbeat"></i> System Health Check</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div id="detailed-system-status">
              <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Checking system health...</p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="refreshSystemStatus()">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Automation Results Modal -->
    <div class="modal fade" id="automationResultsModal" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="fas fa-robot"></i> Automation Results</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div id="automation-results-content">
              <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Running...</span>
                </div>
                <p class="mt-2">Running automation processes...</p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Help Modal -->
    <div class="modal fade" id="quickHelpModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="fas fa-question-circle"></i> Quick Help</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <h6><i class="fas fa-rocket me-2"></i>Getting Started</h6>
                <ul class="small">
                  <li>Upload CSV files or connect data sources</li>
                  <li>Smart ontology generation automatically detects structure</li>
                  <li>Import to Blazegraph triple store</li>
                  <li>Monitor system health and status</li>
                </ul>
                
                <h6><i class="fas fa-magic me-2"></i>Smart Features</h6>
                <ul class="small">
                  <li>Automatic field type detection</li>
                  <li>Smart categorization and relationships</li>
                  <li>No configuration required</li>
                  <li>Adapts to data structure changes</li>
                </ul>
                
                <h6><i class="fas fa-file-csv me-2"></i>CSV Upload</h6>
                <ul class="small">
                  <li>Use UTF-8 encoding</li>
                  <li>Include headers in first row</li>
                  <li>Maximum 32MB file size</li>
                  <li>Multiple files supported</li>
                </ul>
              </div>
              <div class="col-md-6">
                <h6><i class="fas fa-table me-2"></i>Google Sheets</h6>
                <ul class="small">
                  <li>Share sheet with service account</li>
                  <li>Use spreadsheet ID or exact name</li>
                  <li>Automatic change detection</li>
                  <li>Smart ontology generation</li>
                </ul>
                
                <h6><i class="fas fa-database me-2"></i>PostgreSQL</h6>
                <ul class="small">
                  <li>Monitor database changes</li>
                  <li>Generate RDF from tables</li>
                  <li>Automated processing pipeline</li>
                  <li>Real-time monitoring dashboard</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <a href="/documentation" target="_blank" class="btn btn-primary">
              <i class="fas fa-book me-1"></i>Full Documentation
            </a>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Contextual Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="helpModalTitle">Help</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="helpModalContent">
            <div class="text-center">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2">Loading help content...</p>
            </div>
          </div>
          <div class="modal-footer">
            <a href="/documentation" target="_blank" class="btn btn-primary">
              <i class="fas fa-external-link-alt me-1"></i>Full Documentation
            </a>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        checkAllSystemStatus();
        loadRecentActivity();
        
        // Auto-refresh system status every 30 seconds
        setInterval(checkAllSystemStatus, 30000);
        
        // Update file input text when files are selected
        document.getElementById("files").addEventListener("change", function (e) {
          const fileText = document.querySelector(".file-input-text");
          const selectedFiles = document.getElementById("selectedFiles");

          if (this.files.length > 0) {
            fileText.textContent = this.files.length + " files selected";

            // Display selected file names
            let fileListHTML = '<ul class="list-unstyled">';
            for (let i = 0; i < this.files.length; i++) {
              fileListHTML += `<li><i class="fas fa-file-csv text-primary"></i> ${this.files[i].name}</li>`;
            }
            fileListHTML += "</ul>";
            selectedFiles.innerHTML = fileListHTML;
          } else {
            fileText.textContent = "No files selected";
            selectedFiles.innerHTML = "";
          }
        });
      });

      // Show Quick Help Modal
      function showQuickHelp() {
        const modal = new bootstrap.Modal(document.getElementById('quickHelpModal'));
        modal.show();
      }

      // Show Contextual Help
      function showContextualHelp(section) {
        const modal = new bootstrap.Modal(document.getElementById('helpModal'));
        document.getElementById('helpModalTitle').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        document.getElementById('helpModalContent').innerHTML = `
          <div class="text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading help content...</p>
          </div>
        `;
        modal.show();

        fetch(`/help/${section}`)
          .then(response => response.json())
          .then(data => {
            document.getElementById('helpModalTitle').innerHTML = `<i class="fas fa-question-circle me-2"></i>${data.title}`;
            document.getElementById('helpModalContent').innerHTML = data.content;
          })
          .catch(error => {
            console.error('Error loading help:', error);
            document.getElementById('helpModalTitle').innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>Error';
            document.getElementById('helpModalContent').innerHTML = `
              <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Error loading help content. Please try again or check the 
                <a href="/documentation" target="_blank">full documentation</a>.
              </div>
            `;
          });
      }

      // All the rest of your existing JavaScript functions remain the same...
      // (checkAllSystemStatus, updateStatusIndicator, etc.)
      
      // Check all system status
      async function checkAllSystemStatus() {
        try {
          const response = await fetch('/api/system-status');
          const status = await response.json();
          
          updateStatusIndicator('blazegraph', status.blazegraph);
          updateStatusIndicator('sheets', status.google_sheets);
          updateStatusIndicator('postgres', status.postgresql);
          
          // Update integration status indicators
          updateIntegrationStatus('sheets-integration-status', status.google_sheets);
          updateIntegrationStatus('postgres-integration-status', status.postgresql);
          
          // Enable/disable PostgreSQL monitor button
          const postgresBtn = document.getElementById('postgres-monitor-btn');
          if (status.postgresql.enabled && status.postgresql.status === 'connected') {
            postgresBtn.classList.remove('disabled');
            postgresBtn.removeAttribute('disabled');
          } else {
            postgresBtn.classList.add('disabled');
            postgresBtn.setAttribute('disabled', 'disabled');
          }
          
        } catch (error) {
          console.error('Error checking system status:', error);
          // Set all indicators to error state
          ['blazegraph', 'sheets', 'postgres'].forEach(system => {
            const indicator = document.getElementById(`${system}-status`);
            indicator.className = 'status-indicator disconnected';
            indicator.innerHTML = '<i class="fas fa-exclamation-circle me-1"></i> Error';
          });
        }
      }

      function updateStatusIndicator(system, statusData) {
        const indicator = document.getElementById(`${system}-status`);
        let className = 'status-indicator ';
        let content = '';
        
        if (!statusData.enabled) {
          className += 'disabled';
          content = '<i class="fas fa-circle me-1"></i> Disabled';
        } else if (statusData.status === 'online' || statusData.status === 'connected' || statusData.initialized) {
          className += 'connected';
          content = '<i class="fas fa-check-circle me-1"></i> Online';
        } else {
          className += 'disconnected';
          content = '<i class="fas fa-times-circle me-1"></i> Offline';
        }
        
        indicator.className = className;
        indicator.innerHTML = content;
      }

      function updateIntegrationStatus(elementId, statusData) {
        const indicator = document.getElementById(elementId);
        let className = 'status-indicator ';
        let content = '';
        
        if (!statusData.enabled) {
          className += 'disabled';
          content = '<i class="fas fa-circle me-1"></i> Disabled';
        } else if (statusData.status === 'online' || statusData.status === 'connected' || statusData.initialized) {
          className += 'connected';
          content = '<i class="fas fa-check-circle me-1"></i> Connected';
        } else {
          className += 'disconnected';
          content = '<i class="fas fa-times-circle me-1"></i> Error';
        }
        
        indicator.className = className;
        indicator.innerHTML = content;
      }

      // Load recent activity
      async function loadRecentActivity() {
        try {
          const activityHTML = `
            <div class="small">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span><i class="fas fa-clock text-muted me-1"></i> Last ontology generation</span>
                <span class="text-muted">2 hours ago</span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span><i class="fas fa-database text-muted me-1"></i> PostgreSQL sync</span>
                <span class="text-muted">5 hours ago</span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span><i class="fas fa-table text-muted me-1"></i> Google Sheets import</span>
                <span class="text-muted">1 day ago</span>
              </div>
            </div>
          `;
          document.getElementById('recent-activity').innerHTML = activityHTML;
        } catch (error) {
          document.getElementById('recent-activity').innerHTML = 
            '<p class="text-muted">Unable to load recent activity</p>';
        }
      }

      // Run full automation
      async function runFullAutomation() {
        if (!confirm('This will run the complete automation process including PostgreSQL sync, Google Sheets import, and Blazegraph updates. This may take several minutes. Continue?')) {
          return;
        }

        const modal = new bootstrap.Modal(document.getElementById('automationResultsModal'));
        modal.show();

        try {
          document.getElementById('automation-results-content').innerHTML = `
            <div class="text-center">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Running...</span>
              </div>
              <p class="mt-2">Running automation processes...</p>
            </div>
          `;

          const response = await fetch('/run-full-automation', {
            method: 'POST'
          });
          
          const result = await response.json();
          
          let resultsHTML = '<div class="row">';
          
          // PostgreSQL Results
          resultsHTML += `
            <div class="col-md-4">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0"><i class="fas fa-database"></i> PostgreSQL</h6>
                </div>
                <div class="card-body">
                  <div class="text-center">
                    <i class="fas fa-${result.postgresql?.success ? 'check-circle text-success' : 'times-circle text-danger'} fa-2x mb-2"></i>
                    <p class="mb-0">${result.postgresql?.message || 'Not executed'}</p>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          // Google Sheets Results
          resultsHTML += `
            <div class="col-md-4">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0"><i class="fas fa-table"></i> Google Sheets</h6>
                </div>
                <div class="card-body">
                  <div class="text-center">
                    <i class="fas fa-${result.sheets?.success ? 'check-circle text-success' : 'times-circle text-danger'} fa-2x mb-2"></i>
                    <p class="mb-0">${result.sheets?.message || 'Not executed'}</p>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          // Blazegraph Results
          resultsHTML += `
            <div class="col-md-4">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0"><i class="fas fa-project-diagram"></i> Blazegraph</h6>
                </div>
                <div class="card-body">
                  <div class="text-center">
                    <i class="fas fa-${result.blazegraph?.success ? 'check-circle text-success' : 'times-circle text-danger'} fa-2x mb-2"></i>
                    <p class="mb-0">${result.blazegraph?.message || 'Not executed'}</p>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          resultsHTML += '</div>';
          
          const successCount = [result.postgresql?.success, result.sheets?.success, result.blazegraph?.success].filter(Boolean).length;
          resultsHTML += `
            <div class="alert alert-${successCount === 3 ? 'success' : successCount > 0 ? 'warning' : 'danger'} mt-3">
              <h5 class="mb-2"><i class="fas fa-${successCount === 3 ? 'check-circle' : successCount > 0 ? 'exclamation-triangle' : 'times-circle'}"></i> 
                Automation Complete
              </h5>
              <p class="mb-0">Successfully completed ${successCount} out of 3 processes.</p>
            </div>
          `;
          
          document.getElementById('automation-results-content').innerHTML = resultsHTML;
          checkAllSystemStatus();
          
        } catch (error) {
          document.getElementById('automation-results-content').innerHTML = `
            <div class="alert alert-danger">
              <h5><i class="fas fa-exclamation-circle"></i> Error</h5>
              <p>Failed to run automation: ${error.message}</p>
            </div>
          `;
        }
      }

      // Check system health
      async function checkSystemHealth() {
        const modal = new bootstrap.Modal(document.getElementById('systemStatusModal'));
        modal.show();
        refreshSystemStatus();
      }

      async function refreshSystemStatus() {
        document.getElementById('detailed-system-status').innerHTML = `
          <div class="text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Checking system health...</p>
          </div>
        `;

        try {
          const response = await fetch('/system-health');
          const status = await response.json();
          
          let healthHTML = `
            <div class="row">
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-project-diagram"></i> Blazegraph</h6>
                  </div>
                  <div class="card-body">
                    <div class="text-center">
                      <i class="fas fa-${status.services.blazegraph?.status === 'healthy' ? 'check-circle text-success' : 'times-circle text-danger'} fa-2x mb-2"></i>
                      <p><strong>Status:</strong> ${status.services.blazegraph?.status || 'unknown'}</p>
                      <p><strong>Endpoint:</strong><br><small>${status.services.blazegraph?.endpoint || 'N/A'}</small></p>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-table"></i> Google Sheets</h6>
                  </div>
                  <div class="card-body">
                    <div class="text-center">
                      <i class="fas fa-${status.services.google_sheets?.status === 'healthy' ? 'check-circle text-success' : 'times-circle text-danger'} fa-2x mb-2"></i>
                      <p><strong>Enabled:</strong> ${status.services.google_sheets?.enabled ? 'Yes' : 'No'}</p>
                      <p><strong>Status:</strong> ${status.services.google_sheets?.status || 'unknown'}</p>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-database"></i> PostgreSQL</h6>
                  </div>
                  <div class="card-body">
                    <div class="text-center">
                      <i class="fas fa-${status.services.postgresql?.status === 'healthy' ? 'check-circle text-success' : 'times-circle text-danger'} fa-2x mb-2"></i>
                      <p><strong>Status:</strong> ${status.services.postgresql?.status || 'unknown'}</p>
                      <p><strong>Host:</strong> ${status.services.postgresql?.details?.host || 'N/A'}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="mt-3">
              <div class="alert alert-${status.overall_status === 'healthy' ? 'success' : status.overall_status === 'degraded' ? 'warning' : 'danger'}">
                <h6><i class="fas fa-${status.overall_status === 'healthy' ? 'check-circle' : status.overall_status === 'degraded' ? 'exclamation-triangle' : 'times-circle'}"></i> 
                  Overall Status: ${status.overall_status}
                </h6>
                ${status.issues ? `<p class="mb-0">Issues: ${status.issues.join(', ')}</p>` : '<p class="mb-0">All systems operational</p>'}
              </div>
              <p><small><strong>Last Updated:</strong> ${new Date(status.timestamp).toLocaleString()}</small></p>
            </div>
          `;
          
          document.getElementById('detailed-system-status').innerHTML = healthHTML;
          
        } catch (error) {
          document.getElementById('detailed-system-status').innerHTML = `
            <div class="alert alert-danger">
              <i class="fas fa-exclamation-circle"></i>
              Error loading system status: ${error.message}
            </div>
          `;
        }
      }

      // Placeholder functions for other actions
      function viewLogs() {
        alert('Feature coming soon: View system logs');
      }

      function downloadSampleConfig() {
        alert('Feature coming soon: Download sample data template');
      }

      function validateConfig() {
        alert('Feature coming soon: Data structure validation');
      }

      function showSupport() {
        alert('For support, please check the documentation or contact the development team.');
      }
    </script>
  </body>
</html>